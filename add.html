<!-- أضف هذا السكربت في نهاية add.html قبل </body> -->

<script>
document.getElementById("year").textContent = new Date().getFullYear();

window.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("addForm");

  // تحقق من وجود Firebase و db
  if (typeof firebase === "undefined") {
    alert("المشكلة: مكتبة Firebase غير محمّلة. تأكد من السكربتات في أسفل الصفحة.");
    return;
  }

  if (typeof db === "undefined") {
    alert("المشكلة: لم يتم تحميل config.js أو لم يتم تعريف db. تأكد أن الملف موجود في نفس المجلد.");
    return;
  }

  form.addEventListener("submit", e => {
    e.preventDefault();

    const carNumber = document.getElementById("carNumber").value;
    const plateCode = document.getElementById("plateCode").value;
    const owner = document.getElementById("owner").value;
    const driver = document.getElementById("driver").value;
    const insuranceExpiry = document.getElementById("insuranceExpiry").value;
    const licenseExpiry = document.getElementById("licenseExpiry").value;
    const notes = document.getElementById("notes").value;

    db.collection("cars").add({
      carNumber,
      plateCode,
      owner,
      driver,
      insuranceExpiry,
      licenseExpiry,
      notes,
      archived: false,
      createdAt: new Date().toISOString()
    }).then(() => {
      alert("✅ تمت إضافة السيارة بنجاح");
      window.location.href = "index.html";
    }).catch(err => {
      alert("❌ فشل في الإضافة: " + err.message);
    });
  });
});
</script>
