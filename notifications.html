<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title data-lang="notifications_page">الإشعارات</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="sidebar"></div>
  <div id="topbar"></div>

  <main class="container">
    <header class="page-header">
      <h1 data-lang="notifications_page">الإشعارات</h1>
    </header>

    <section>
      <ul id="notificationsList" class="notifications-list"></ul>
    </section>
  </main>

  <script src="firebase.js"></script>
  <script src="session.js"></script>
  <script src="ui.js"></script>
  <script src="lang.js"></script>
  <script>
    ensureAuthRedirect();

    async function loadNotifications(){
      const notes = await readOnce('notifications') || {};
      const ul = document.getElementById('notificationsList');
      ul.innerHTML = '';
      Object.entries(notes).sort((a,b)=> (b[1].timestamp||0)-(a[1].timestamp||0)).forEach(([id,n])=>{
        const li = document.createElement('li');
        li.className = n.read ? 'read' : 'unread';
        li.innerHTML = `<div class="note-title">${escapeHtml(n.title)}</div><div class="note-time">${new Date(n.timestamp||0).toLocaleString()}</div>`;
        ul.appendChild(li);
      });
    }

    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }

    applyTranslations();
    loadNotifications();
  </script>
</body>
</html>
